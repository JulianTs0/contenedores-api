@startuml
title TramoService - asignarCamion 

hide footbox

actor "Cliente/API" as C
control "TramoService" as TS
participant "TramoRepository" as TR
control "EnviosService" as ES
control "CamionService" as CMS
control "UsuarioService" as US
control "ContenedorService" as CS

C -> TS: asignarCamion(request)

activate TS

TS -> TR: getById(idTramo)
activate TR
TR --> TS: tramo
deactivate TR

TS -> ES: getSolicitudTrasladoById(idSolicitud)
activate ES
ES --> TS: solicitud
deactivate ES

TS -> CMS: getById(dominio)
activate CMS
    CMS -> US: getById(idTransportista)
    activate US
    US --> CMS: usuario
    deactivate US
CMS --> TS: camion
deactivate CMS

TS -> TR: buscarPorRuta(idRuta)
activate TR
TR --> TS: listaTramos
deactivate TR

opt Todos los tramos asignados
    TS -> ES: cambioDeEstadoSolicitud(programado)
    activate ES
    ES --> TS: response
    deactivate ES

    TS -> CS: cambioDeEstado(programado)
    activate CS
    CS --> TS: response
    deactivate CS
end

deactivate TS
@enduml
